<header class="navigation-header" role="banner">
  <div class="navigation-header__container">
    <div class="navigation-header__brand">
      <a
        [routerLink]="['/dashboard']"
        class="navigation-header__logo-link"
        aria-label="Ir al dashboard principal"
      >
        <fa-icon [icon]="faChartLine" class="fa-2x"></fa-icon>
        <span class="navigation-header__app-name">{{ appName }}</span>
      </a>
    </div>
    <nav
      class="navigation-header__nav"
      role="navigation"
      aria-label="Navegación principal"
    >
      <ul class="navigation-header__nav-list">
        <li
          *ngFor="let item of navigationItems"
          class="navigation-header__nav-item"
        >
          <a
            [routerLink]="[item.route]"
            routerLinkActive="navigation-header__nav-link--active"
            [routerLinkActiveOptions]="{ exact: true }"
            class="navigation-header__nav-link"
            (click)="onNavigationClick(item)"
            [attr.aria-current]="isNavigationActive(item) ? 'page' : null"
          >
            <fa-icon
              *ngIf="item.icon"
              [icon]="getNavigationIcon(item.icon)"
              class="fa-sm"
            ></fa-icon>
            <span>{{ item.label }}</span>
            <span
              *ngIf="item.badge"
              class="navigation-header__nav-badge"
              [attr.aria-label]="item.badge + ' elementos nuevos'"
              >{{ item.badge }}</span
            >
          </a>
        </li>
      </ul>
    </nav>
    <div class="navigation-header__user-section">
      <div
        *ngIf="showNotifications"
        class="navigation-header__notifications"
        #notificationsRef
      >
        <button
          class="navigation-header__notification-btn"
          aria-label="Ver notificaciones"
          type="button"
          (click)="toggleNotifications()"
          [attr.aria-expanded]="isNotificationsOpen"
        >
          <fa-icon [icon]="faBell" class="fa-lg"></fa-icon>
          <span
            *ngIf="unreadNotificationsCount > 0"
            class="navigation-header__notification-badge"
            [attr.aria-label]="
              unreadNotificationsCount + ' notificaciones nuevas'
            "
          >
            {{
              unreadNotificationsCount > 99 ? "99+" : unreadNotificationsCount
            }}
          </span>
        </button>
        <div
          [class]="notificationsClasses"
          role="menu"
          aria-labelledby="notifications-menu"
        >
          <div class="navigation-header__notifications-header">
            <h3>Notificaciones</h3>
            <button
              *ngIf="unreadNotificationsCount > 0"
              class="navigation-header__mark-all-read-btn"
              (click)="markAllNotificationsAsRead()"
              type="button"
            >
              Marcar todas como leídas
            </button>
          </div>

          <div class="navigation-header__notifications-list">
            <div
              *ngFor="let notification of notifications"
              class="navigation-header__notification-item"
              [class.navigation-header__notification-item--unread]="
                !notification.isRead
              "
              (click)="onNotificationClick(notification)"
              role="menuitem"
            >
              <div class="navigation-header__notification-content">
                <h4>{{ notification.title }}</h4>
                <p>{{ notification.message }}</p>
                <time>{{ notification.timestamp | date: "short" }}</time>
              </div>
              <div
                class="navigation-header__notification-indicator"
                [class]="
                  'navigation-header__notification-indicator--' +
                  notification.type
                "
              ></div>
            </div>

            <div
              *ngIf="notifications.length === 0"
              class="navigation-header__notifications-empty"
            >
              <p>No hay notificaciones</p>
            </div>
          </div>
        </div>
      </div>
      <div
        *ngIf="showUserMenu && userProfile"
        class="navigation-header__user-menu"
        #userMenuRef
      >
        <button
          class="navigation-header__user-btn"
          aria-label="Abrir menú de usuario"
          [attr.aria-expanded]="isUserMenuOpen"
          aria-haspopup="true"
          type="button"
          (click)="toggleUserMenu()"
        >
          <img
            [src]="getAvatarUrl(userProfile.email)"
            [alt]="'Foto de perfil de ' + userProfile.name"
            class="navigation-header__user-avatar"
            (error)="onImageError($event)"
          />
          <span class="navigation-header__user-name">{{
            userProfile.name
          }}</span>
          <fa-icon [icon]="faChevronDown" class="fa-sm"></fa-icon>
        </button>
        <div [class]="userMenuClasses" role="menu" aria-labelledby="user-menu">
          <div class="navigation-header__user-info">
            <span class="navigation-header__user-email">{{
              userProfile.email
            }}</span>
          </div>

          <a
            routerLink="/profile"
            class="navigation-header__dropdown-item"
            role="menuitem"
            (click)="onUserMenuAction('profile')"
          >
            <fa-icon [icon]="faUser" class="fa-sm"></fa-icon>
            Mi Perfil
          </a>

          <a
            routerLink="/settings"
            class="navigation-header__dropdown-item"
            role="menuitem"
            (click)="onUserMenuAction('settings')"
          >
            <fa-icon [icon]="faCog" class="fa-sm"></fa-icon>
            Configuración
          </a>

          <hr class="navigation-header__dropdown-divider" role="separator" />

          <button
            class="navigation-header__dropdown-item navigation-header__dropdown-item--logout"
            role="menuitem"
            (click)="onLogout()"
          >
            <fa-icon [icon]="faSignOutAlt" class="fa-sm"></fa-icon>
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </div>

  <button
    class="navigation-header__mobile-menu-btn"
    aria-label="Abrir menú de navegación"
    [attr.aria-expanded]="isMobileMenuOpen"
    type="button"
    (click)="toggleMobileMenu()"
  >
    <span class="navigation-header__hamburger-line"></span>
    <span class="navigation-header__hamburger-line"></span>
    <span class="navigation-header__hamburger-line"></span>
  </button>
  <div [class]="mobileOverlayClasses"></div>
  <nav
    [class]="mobileMenuClasses"
    role="navigation"
    aria-label="Navegación móvil"
  >
    <div class="navigation-header__mobile-nav-section">
      <h3 class="navigation-header__mobile-nav-title">Navegación</h3>
      <ul class="navigation-header__mobile-nav-list">
        <li
          *ngFor="let item of navigationItems"
          class="navigation-header__mobile-nav-item"
        >
          <a
            [routerLink]="[item.route]"
            routerLinkActive="navigation-header__mobile-nav-link--active"
            [routerLinkActiveOptions]="{ exact: true }"
            class="navigation-header__mobile-nav-link"
            (click)="onNavigationClick(item)"
            [attr.aria-current]="isNavigationActive(item) ? 'page' : null"
          >
            <fa-icon
              *ngIf="item.icon"
              [icon]="getNavigationIcon(item.icon)"
              class="fa-sm"
            ></fa-icon>
            {{ item.label }}
            <span
              *ngIf="item.badge"
              class="navigation-header__mobile-nav-badge"
              >{{ item.badge }}</span
            >
          </a>
        </li>
      </ul>
    </div>
    <div
      *ngIf="showNotifications"
      class="navigation-header__mobile-nav-section"
    >
      <div class="navigation-header__mobile-nav-header">
        <h3 class="navigation-header__mobile-nav-title">Notificaciones</h3>
        <button
          *ngIf="unreadNotificationsCount > 0"
          class="navigation-header__mobile-mark-all-read-btn"
          (click)="markAllNotificationsAsRead()"
          type="button"
        >
          Marcar todas como leídas
        </button>
      </div>

      <div class="navigation-header__mobile-notifications-list">
        <div
          *ngFor="let notification of notifications.slice(0, 3)"
          class="navigation-header__mobile-notification-item"
          [class.navigation-header__mobile-notification-item--unread]="
            !notification.isRead
          "
          (click)="onMobileNotificationClick(notification)"
        >
          <div class="navigation-header__mobile-notification-content">
            <h4>{{ notification.title }}</h4>
            <p>{{ notification.message }}</p>
            <time>{{ notification.timestamp | date: "short" }}</time>
          </div>
          <div
            class="navigation-header__mobile-notification-indicator"
            [class]="
              'navigation-header__mobile-notification-indicator--' +
              notification.type
            "
          ></div>
        </div>

        <div
          *ngIf="notifications.length === 0"
          class="navigation-header__mobile-notifications-empty"
        >
          <p>No hay notificaciones</p>
        </div>

        <div
          *ngIf="notifications.length > 3"
          class="navigation-header__mobile-notifications-more"
        >
          <p>Ver {{ notifications.length - 3 }} notificaciones más</p>
        </div>
      </div>
    </div>
    <div
      *ngIf="showUserMenu && userProfile"
      class="navigation-header__mobile-nav-section"
    >
      <div class="navigation-header__mobile-user-info">
        <img
          [src]="getAvatarUrl(userProfile.email)"
          [alt]="'Foto de perfil de ' + userProfile.name"
          class="navigation-header__mobile-user-avatar"
          (error)="onImageError($event)"
        />
        <div class="navigation-header__mobile-user-details">
          <span class="navigation-header__mobile-user-name">{{
            userProfile.name
          }}</span>
          <span class="navigation-header__mobile-user-email">{{
            userProfile.email
          }}</span>
        </div>
      </div>

      <div class="navigation-header__mobile-user-actions">
        <a
          routerLink="/profile"
          class="navigation-header__mobile-user-action"
          (click)="onMobileUserAction('profile')"
        >
          <fa-icon [icon]="faUser" class="fa-sm"></fa-icon>
          Mi Perfil
        </a>

        <a
          routerLink="/settings"
          class="navigation-header__mobile-user-action"
          (click)="onMobileUserAction('settings')"
        >
          <fa-icon [icon]="faCog" class="fa-sm"></fa-icon>
          Configuración
        </a>

        <button
          class="navigation-header__mobile-user-action navigation-header__mobile-user-action--logout"
          (click)="onMobileLogout()"
        >
          <fa-icon [icon]="faSignOutAlt" class="fa-sm"></fa-icon>
          Cerrar Sesión
        </button>
      </div>
    </div>
  </nav>
</header>
