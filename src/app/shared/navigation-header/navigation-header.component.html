<header class="navigation-header" role="banner">
  <div class="navigation-header__container">
    <!-- Logo y branding -->
    <div class="navigation-header__brand">
      <a
        [routerLink]="['/dashboard']"
        class="navigation-header__logo-link"
        aria-label="Ir al dashboard principal"
      >
        <svg
          class="navigation-header__logo"
          width="32"
          height="32"
          viewBox="0 0 32 32"
          aria-hidden="true"
        >
          <circle cx="16" cy="16" r="14" fill="currentColor" />
          <path d="M10 16h12M16 10v12" stroke="white" stroke-width="2" />
        </svg>
        <span class="navigation-header__app-name">{{ appName }}</span>
      </a>
    </div>

    <!-- Navegación principal -->
    <nav
      class="navigation-header__nav"
      role="navigation"
      aria-label="Navegación principal"
    >
      <ul class="navigation-header__nav-list">
        <li
          *ngFor="let item of navigationItems"
          class="navigation-header__nav-item"
        >
          <a
            [routerLink]="[item.route]"
            routerLinkActive="navigation-header__nav-link--active"
            [routerLinkActiveOptions]="{ exact: true }"
            class="navigation-header__nav-link"
            (click)="onNavigationClick(item)"
            [attr.aria-current]="isNavigationActive(item) ? 'page' : null"
          >
            <svg
              *ngIf="item.icon === 'dashboard'"
              class="navigation-header__nav-icon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" />
            </svg>
            <svg
              *ngIf="item.icon === 'transactions'"
              class="navigation-header__nav-icon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="12" y1="1" x2="12" y2="23" />
              <path d="m17 5-5-5-5 5" />
              <path d="m7 19 5 5 5-5" />
            </svg>
            <svg
              *ngIf="item.icon === 'credit'"
              class="navigation-header__nav-icon"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
              <line x1="1" y1="10" x2="23" y2="10" />
            </svg>
            <span>{{ item.label }}</span>
            <span
              *ngIf="item.badge"
              class="navigation-header__nav-badge"
              [attr.aria-label]="item.badge + ' elementos nuevos'"
              >{{ item.badge }}</span
            >
          </a>
        </li>
      </ul>
    </nav>

    <!-- Sección de usuario y acciones -->
    <div class="navigation-header__user-section">
      <!-- Notificaciones -->
      <div
        *ngIf="showNotifications"
        class="navigation-header__notifications"
        #notificationsRef
      >
        <button
          class="navigation-header__notification-btn"
          aria-label="Ver notificaciones"
          type="button"
          (click)="toggleNotifications()"
          [attr.aria-expanded]="isNotificationsOpen"
        >
          <svg
            class="navigation-header__notification-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          </svg>
          <span
            *ngIf="unreadNotificationsCount > 0"
            class="navigation-header__notification-badge"
            [attr.aria-label]="
              unreadNotificationsCount + ' notificaciones nuevas'
            "
          >
            {{
              unreadNotificationsCount > 99 ? "99+" : unreadNotificationsCount
            }}
          </span>
        </button>

        <!-- Dropdown de notificaciones -->
        <div
          [class]="notificationsClasses"
          role="menu"
          aria-labelledby="notifications-menu"
        >
          <div class="navigation-header__notifications-header">
            <h3>Notificaciones</h3>
            <button
              *ngIf="unreadNotificationsCount > 0"
              class="navigation-header__mark-all-read-btn"
              (click)="markAllNotificationsAsRead()"
              type="button"
            >
              Marcar todas como leídas
            </button>
          </div>

          <div class="navigation-header__notifications-list">
            <div
              *ngFor="let notification of notifications"
              class="navigation-header__notification-item"
              [class.navigation-header__notification-item--unread]="
                !notification.isRead
              "
              (click)="onNotificationClick(notification)"
              role="menuitem"
            >
              <div class="navigation-header__notification-content">
                <h4>{{ notification.title }}</h4>
                <p>{{ notification.message }}</p>
                <time>{{ notification.timestamp | date: "short" }}</time>
              </div>
              <div
                class="navigation-header__notification-indicator"
                [class]="
                  'navigation-header__notification-indicator--' +
                  notification.type
                "
              ></div>
            </div>

            <div
              *ngIf="notifications.length === 0"
              class="navigation-header__notifications-empty"
            >
              <p>No hay notificaciones</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Menú de usuario -->
      <div
        *ngIf="showUserMenu && userProfile"
        class="navigation-header__user-menu"
        #userMenuRef
      >
        <button
          class="navigation-header__user-btn"
          aria-label="Abrir menú de usuario"
          [attr.aria-expanded]="isUserMenuOpen"
          aria-haspopup="true"
          type="button"
          (click)="toggleUserMenu()"
        >
          <img
            [src]="userProfile.avatar || 'assets/images/default-avatar.png'"
            [alt]="'Foto de perfil de ' + userProfile.name"
            class="navigation-header__user-avatar"
          />
          <span class="navigation-header__user-name">{{
            userProfile.name
          }}</span>
          <svg
            class="navigation-header__user-chevron"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="6,9 12,15 18,9" />
          </svg>
        </button>

        <!-- Dropdown del menú de usuario -->
        <div [class]="userMenuClasses" role="menu" aria-labelledby="user-menu">
          <div class="navigation-header__user-info">
            <span class="navigation-header__user-email">{{
              userProfile.email
            }}</span>
          </div>

          <a
            routerLink="/profile"
            class="navigation-header__dropdown-item"
            role="menuitem"
            (click)="onUserMenuAction('profile')"
          >
            <svg
              class="navigation-header__dropdown-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Mi Perfil
          </a>

          <a
            routerLink="/settings"
            class="navigation-header__dropdown-item"
            role="menuitem"
            (click)="onUserMenuAction('settings')"
          >
            <svg
              class="navigation-header__dropdown-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="3" />
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" />
            </svg>
            Configuración
          </a>

          <hr class="navigation-header__dropdown-divider" role="separator" />

          <button
            class="navigation-header__dropdown-item navigation-header__dropdown-item--logout"
            role="menuitem"
            (click)="onLogout()"
          >
            <svg
              class="navigation-header__dropdown-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16,17 21,12 16,7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>

    <!-- Botón de menú móvil -->
    <button
      class="navigation-header__mobile-menu-btn"
      aria-label="Abrir menú de navegación"
      [attr.aria-expanded]="isMobileMenuOpen"
      type="button"
      (click)="toggleMobileMenu()"
    >
      <span class="navigation-header__hamburger-line"></span>
      <span class="navigation-header__hamburger-line"></span>
      <span class="navigation-header__hamburger-line"></span>
    </button>
  </div>

  <!-- Menú móvil -->
  <nav
    [class]="mobileMenuClasses"
    role="navigation"
    aria-label="Navegación móvil"
  >
    <ul class="navigation-header__mobile-nav-list">
      <li
        *ngFor="let item of navigationItems"
        class="navigation-header__mobile-nav-item"
      >
        <a
          [routerLink]="[item.route]"
          routerLinkActive="navigation-header__mobile-nav-link--active"
          [routerLinkActiveOptions]="{ exact: true }"
          class="navigation-header__mobile-nav-link"
          (click)="onNavigationClick(item)"
          [attr.aria-current]="isNavigationActive(item) ? 'page' : null"
        >
          <svg
            *ngIf="item.icon === 'dashboard'"
            class="navigation-header__nav-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="3" width="7" height="7" />
            <rect x="14" y="3" width="7" height="7" />
            <rect x="14" y="14" width="7" height="7" />
            <rect x="3" y="14" width="7" height="7" />
          </svg>
          <svg
            *ngIf="item.icon === 'transactions'"
            class="navigation-header__nav-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="12" y1="1" x2="12" y2="23" />
            <path d="m17 5-5-5-5 5" />
            <path d="m7 19 5 5 5-5" />
          </svg>
          <svg
            *ngIf="item.icon === 'credit'"
            class="navigation-header__nav-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
            <line x="1" y1="10" x2="23" y2="10" />
          </svg>
          {{ item.label }}
          <span
            *ngIf="item.badge"
            class="navigation-header__mobile-nav-badge"
            >{{ item.badge }}</span
          >
        </a>
      </li>
    </ul>
  </nav>
</header>
